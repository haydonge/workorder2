---
import React from 'react';
import { useState } from 'react';
import FilterToggle from '../components/FilterToggle.jsx'; // 假设组件路径
import WorkCard from "../components/workcard.astro";
import BaseLayout from "../layout/BaseLayout.astro";

const response = await fetch("https://opensheet.elk.sh/1ge-pyzr0uMTxlALiiUh_sEzdVo1ikGJGavLF04u6AVU/4");
const data = await response.json();

const filteredData = data.filter((item:any) => item.完成状态==="未完成"&& item.急单==="急").map((item: any) => ({
  workorder: item.工单号,
  name: item.申请人,
  works: item.治具名称,
  startdate: item.申请日期,
  enddate: item.需求日期,
  priority: item.急单,
}));

const filteredData2 = data.filter((item:any) => item.完成状态==="未完成"&& item.急单!=="急").map((item: any) => ({
  workorder: item.工单号,
  name: item.申请人,
  works: item.治具名称,
  startdate: item.申请日期,
  enddate: item.需求日期,
  priority: item.急单,
}));

const [currentFilter, setCurrentFilter] = useState("urgent"); // 默认显示急单

const toggleFilter = () => {
  setCurrentFilter((prevFilter) => (prevFilter === "urgent" ? "non-urgent" : "urgent"));
};
---

<BaseLayout>
  <main class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2 px-2">
    <FilterToggle onClick={toggleFilter} currentFilter={currentFilter} />
    {currentFilter === "urgent" ? (
      filteredData.map((data: any) => <WorkCard data={data} />)
    ) : (
      filteredData2.map((data2: any) => <WorkCard data={data2} />)
    )}
  </main>
</BaseLayout>